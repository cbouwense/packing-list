<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Gotta pack</title>
    <style>
      body {
        font-size: 28px;
      }

      input {
        zoom: 2;
      }
    </style>
  </head>
  <body>
    <main style="display: flex; gap: 1rem; flex-direction: column; width: 100%; align-items: center;">
      <ul id="packing-list"><!-- items will be added here --></ul>
      <div>
        <input type="checkbox" id="all-packed" name="all-packed" value="all-packed" onclick="checkOrUncheckAll('packed')">
        <label for="all-packed">All packed</label>
      </div>
      <div>
        <input type="checkbox" id="all-staged" name="all-staged" value="all-staged" onclick="checkOrUncheckAll('staged')">
        <label for="all-staged">All staged</label>
      </div>
      <div>
        <input type="checkbox" id="all-in-car" name="all-in-car" value="all-in-car" onclick="checkOrUncheckAll('car')">
        <label for="all-in-car">All in car</label>
      </div>
      <input type="text" id="new-item" name="new-item" value="" />
      <button onclick="addNewItem()">add</button>
    </main>

    <script>
      /**
       * @param elem {EventTarget}
       * @returns {void}
       */
      function updateCheckedState(elem) {
        if (elem) {
          const [item, state] = elem.id.split('-');

          switch (state) {
            case 'packed':
              document.getElementById(`${item}-staged`).checked = false;
              document.getElementById(`${item}-car`).checked = false;
              break;
            case 'staged':
              document.getElementById(`${item}-packed`).checked = true;
              document.getElementById(`${item}-car`).checked = false;
              break;
            case 'car':
              document.getElementById(`${item}-packed`).checked = true;
              document.getElementById(`${item}-staged`).checked = true;
              break;
          }
        }

        const checkboxes = document.getElementById('packing-list').querySelectorAll('input[type="checkbox"]');
        const packedCheckboxes = [...checkboxes].filter(checkbox => checkbox.id.includes('packed'));
        const stagedCheckboxes = [...checkboxes].filter(checkbox => checkbox.id.includes('staged'));
        const carCheckboxes = [...checkboxes].filter(checkbox => checkbox.id.includes('car'));

        const allPackedChecked = [...packedCheckboxes].every(checkbox => checkbox.checked);
        document.getElementById('all-packed').checked = allPackedChecked;

        const allStagedChecked = [...stagedCheckboxes].every(checkbox => checkbox.checked);
        document.getElementById('all-staged').checked = allStagedChecked;

        const allCarChecked = [...carCheckboxes].every(checkbox => checkbox.checked);
        document.getElementById('all-in-car').checked = allCarChecked;
      }

      /**
       * @param state {string} 'packed', 'staged', 'car'
       * @returns {void}
       */
      function checkOrUncheckAll(state) {
        const checkboxes = document.getElementById('packing-list').querySelectorAll('input[type="checkbox"]');
        const packedCheckboxes = [...checkboxes].filter(checkbox => checkbox.id.includes('packed'));
        const stagedCheckboxes = [...checkboxes].filter(checkbox => checkbox.id.includes('staged'));
        const carCheckboxes = [...checkboxes].filter(checkbox => checkbox.id.includes('car'));
        const relevantCheckboxes = state === 'packed' ? packedCheckboxes : (state === 'staged' ? stagedCheckboxes : carCheckboxes);

        const allChecked = [...relevantCheckboxes].every(checkbox => checkbox.checked);
        const someAreChecked = [...relevantCheckboxes].some(checkbox => checkbox.checked);
        const noneAreChecked = !someAreChecked;

        // if all are checked, uncheck all, and vice versa
        switch(state) {
          case 'packed':
            if (allChecked) {
              [...relevantCheckboxes].forEach(checkbox => checkbox.checked = false);
            } else {
              [...relevantCheckboxes].forEach(checkbox => checkbox.checked = true);
            }
            stagedCheckboxes.forEach(checkbox => checkbox.checked = false);
            carCheckboxes.forEach(checkbox => checkbox.checked = false);
            break;
          case 'staged':
            if (allChecked) {
              [...relevantCheckboxes].forEach(checkbox => checkbox.checked = false);
            } else {
              [...relevantCheckboxes].forEach(checkbox => checkbox.checked = true);
            }
            packedCheckboxes.forEach(checkbox => checkbox.checked = true);
            carCheckboxes.forEach(checkbox => checkbox.checked = false);
            break;
          case 'car':
            if (allChecked) {
              [...relevantCheckboxes].forEach(checkbox => checkbox.checked = false);
            } else {
              [...relevantCheckboxes].forEach(checkbox => checkbox.checked = true);
            }
            packedCheckboxes.forEach(checkbox => checkbox.checked = true);
            stagedCheckboxes.forEach(checkbox => checkbox.checked = true);
            break;
        }
        updateCheckedState();
      }

      function generateCheckboxItem(itemName) {
        const itemNameWithoutSpaces = itemName.replace(/ /g, '');

        const li = document.createElement('li');
        li.style.display = 'flex';
        li.style.justifyContent = 'space-between';

        const checkbox1 = document.createElement('input');
        checkbox1.type = 'checkbox';
        checkbox1.id = itemNameWithoutSpaces + '-packed';
        checkbox1.onclick = function() { updateCheckedState(this); };

        const checkbox2 = document.createElement('input');
        checkbox2.type = 'checkbox';
        checkbox2.id = itemNameWithoutSpaces + '-staged';
        checkbox2.onclick = function() { updateCheckedState(this); };

        const checkbox3 = document.createElement('input');
        checkbox3.type = 'checkbox';
        checkbox3.id = itemNameWithoutSpaces + '-car';
        checkbox3.onclick = function() { updateCheckedState(this); };

        const span = document.createElement('span');
        span.textContent = itemName;

        const button = document.createElement('button');
        button.textContent = 'delete';
        button.onclick = function() { deleteItem(this); };

        const checkboxDiv = document.createElement('div');

        checkboxDiv.appendChild(checkbox1);
        checkboxDiv.appendChild(checkbox2);
        checkboxDiv.appendChild(checkbox3);
        checkboxDiv.appendChild(span);
        li.appendChild(checkboxDiv);
        li.appendChild(button);

        document.getElementById('packing-list').appendChild(li);
      }

      function addNewItem() {
        const itemName = document.getElementById('new-item').value;
        if (!itemName) return;
        // If item already exists, do nothing
        if (document.getElementById(itemName.replace(/ /g, '') + '-packed')) return;
        if (document.getElementById(itemName.replace(/ /g, '') + '-staged')) return;
        if (document.getElementById(itemName.replace(/ /g, '') + '-car')) return;
        
        generateCheckboxItem(itemName);
        document.getElementById('new-item').value = '';
        updateCheckedState();
      }

      function deleteItem(item) {
        const itemName = item.parentElement.querySelector('span').textContent;
        document.getElementById(itemName.replace(/ /g, '') + '-packed').checked = false;
        document.getElementById(itemName.replace(/ /g, '') + '-staged').checked = false;
        document.getElementById(itemName.replace(/ /g, '') + '-car').checked = false;
        item.parentElement.remove();
        updateCheckedState();
      }

      const items = [
        'pkw',
        'sunglasses',
        'glasses',
        'ear buds',
        'phone charger',
        'eye mask',
        'ear plugs',
        'inhaler',
        'clothes',
        'toiletries',
        'water bottle',
        'books',
        'lumbar pad',
        'lumbar towel',
        'sandals',
      ];

      items.forEach(item => generateCheckboxItem(item));

      // Do once on page load
      updateCheckedState();
    </script>
  </body>
</html>